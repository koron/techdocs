# go.mod の toolchain とは?

## ドキュメントの要約

go.mod の `toolchain` 命令は Go 1.21 以降から利用可能になった。

`go` 命令は対象のモジュールを利用するのに必要なGoの最小バージョンを指定する。
対して `toolchain` 命令は対象モジュールで利用するツールチェイン(のバージョン)を提案するのに使われる。
コンパイル対象がmain モジュールかつ、またデフォルトのツールチェインが提案のものよりも古い場合にのみ、この命令が効果を発揮する。

Goの配布物は1.21より go コマンドとそのツールチェイン(コンパイラ、アセンブラ、その他のツール)から構成されるようになった。
go コマンドはバンドルされたツールチェインと同様に、異なるバージョンのツールチェインを(ダウンロードして)利用できるようになった。

ツールチェインのデフォルトは `GOTOOLCHAIN` 環境変数で決定できるほか、go.mod や go.work ファイルの `toolchain` で指定できる。
mainモジュールかワークスペースの `toolchain` 指定が、バンドルツールチェインよりも新しい場合、そのツールチェインをダウンロードして利用する。
たとえば Go 1.21.3 の go コマンドで `go 1.21.0` を指定した main モジュールをビルドする場合、これは Go 1.21.3 にバンドルされたツールチェインでビルドする。
ここで `go` もしくは `toolchain` 命令が 1.21.9 を指定していた場合、goコマンドは1.21.9のツールチェインを探して利用する。
このとき PATH から `go1.21.9` というコマンドを探して実行するが、それが無い場合はインターネットからダウンロードしキャッシュしたモノを実行する。
この仕組みは無効化できるが、無効化した場合、より新しいGoやツールチェインが指定されるとビルドを拒否する。

## 所感1

新しい言語機能を使いたい場合は `go` を指定する。
これは指定よりも古い Go ではビルドできないことを示す。

新しいツールチェインの機能を使いたい場合は `toolchain` を指定する。
となると各ツールチェインバージョンの新機能は何か、が気になる。

おもな用途としては自分のライブラリが(正式リリース前の)新しいGoで動くか試すことが考えられる。
逆に、それ以外の用途では `go` の指定だけで充分であると言え、通常 `toolchain` を指定する意味はない。

## 参考

*   <https://go.dev/doc/toolchain>
*   <https://go.dev/doc/modules/gomod-ref>
*   <https://go.dev/ref/mod#go-mod-file-toolchain>
